// matrix.c
// Логика этой модули

/*

Здесь реализованы функции для работы с квадратной матрицей:
 1) Ввод элементов матрицы (input_matrix)
 2) Печать всей матрицы (print_matrix)
 3) Печать заштрихованной области (print_zone)
 4) Поиск максимального элемента в заштрихованной области (find_max_in_zone)

Заштрихованная область определяется условием:
    j >= max(i, n-1 - i)

Где:
 - i — номер строки (считаем с 0),
 - j — номер столбца (считаем с 0),
 - n — размерность матрицы.

Пример для n = 5:

 i\j   0   1   2   3   4
  0    -   -   -   -   *   (j >= 4)
  1    -   -   -   *   *   (j >= 3)
  2    -   -   *   *   *   (j >= 2)
  3    -   -   -   *   *   (j >= 3)
  4    -   -   -   -   *   (j >= 4)

Символ "*" означает, что элемент входит в заштрихованную область

*/

#include <stdio.h>
#include <float.h>   
#include "matrix.h"  // Заголовочный файл с прототипами функций

/* 
Функция input_matrix
Назначение: ввод матрицы с клавиатуры.
Аргументы:
 - n — размерность матрицы (количество строк и столбцов),
 - matrix — двумерный массив, где будут храниться введённые значения.
*/

void input_matrix(int n, double matrix[MAX_N][MAX_N]) {
    printf("Введите элементы матрицы %dx%d (по строкам):\n", n, n);
    for (int i = 0; i < n; ++i) {         // Перебирает строки
        for (int j = 0; j < n; ++j) {     // Перебирает столбцы
            if (scanf("%lf", &matrix[i][j]) != 1) { // Читает число
                // Если пользователь ввёл неверное значение, ставим 0
                printf("Ввод некорректен, элемент [%d][%d] установлен в 0.\n", i, j);
                matrix[i][j] = 0.0;
            }
        }
    }
}

/* 
Функция print_matrix
Назначение: выводит на экран всю матрицу в виде таблицы.
Аргументы:
 - n — размерность,
 - matrix — матрица.
*/
void print_matrix(int n, double matrix[MAX_N][MAX_N]) {
    printf("\nВведённая матрица %dx%d:\n", n, n);
    for (int i = 0; i < n; ++i) {
        for (int j = 0; j < n; ++j) {
            // %6.2f — отводит 6 позиций, выводим 2 знака после запятой
            printf("%6.2f ", matrix[i][j]);
        }
        printf("\n");
    }
}

/* 
Вспомогательная функция is_in_zone
Назначение: проверяет, входит ли элемент матрицы в заштрихованную область.
Аргументы:
 - n — размерность матрицы,
 - i — номер строки,
 - j — номер столбца.
Возвращает:
 - 1 (истина), если элемент принадлежит области,
 - 0 (ложь), если нет.
*/
static int is_in_zone(int n, int i, int j) {
    int threshold = (i > (n - 1 - i)) ? i : (n - 1 - i); // max(i, n-1-i)
    return j >= threshold;
}

/* 
Функция print_zone
Назначение: печатает только заштрихованную область матрицы.
Аргументы:
 - n — размерность,
 - matrix — сама матрица.
Примечание:
 - элементы внутри области выводятся числом,
 - элементы вне области заменяются на "--".
*/
void print_zone(int n, double matrix[MAX_N][MAX_N]) {
    printf("\nЗаштрихованная область (числа — внутри области, \"--\" — вне области):\n");
    for (int i = 0; i < n; ++i) {
        for (int j = 0; j < n; ++j) {
            if (is_in_zone(n, i, j)) {
                printf("%6.2f ", matrix[i][j]);
            } else {
                printf("   --   "); // Заменяет элементы вне области
            }
        }
        printf("\n");
    }
}

/* 
Функция find_max_in_zone
Назначение: ищет максимальный элемент в заштрихованной области.
Аргументы:
 - n — размерность матрицы,
 - matrix — матрица.
Возвращает:
 - значение наибольшего элемента в области.
*/
double find_max_in_zone(int n, double matrix[MAX_N][MAX_N]) {
    double max_value = 0.0; // Переменная для хранения максимума
    int found = 0;          // Флаг: найден ли хотя бы один элемент

    for (int i = 0; i < n; ++i) {
        for (int j = 0; j < n; ++j) {
            if (is_in_zone(n, i, j)) { // Проверяет, принадлежит ли элемент области
                if (!found) {
                    max_value = matrix[i][j]; // Первый элемент инициализирует максимум
                    found = 1;
                } else if (matrix[i][j] > max_value) {
                    max_value = matrix[i][j]; // Найдет большее значение
                }
            }
        }
    }

    return max_value;
}
