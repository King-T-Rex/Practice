/* 
Автор: Кузнецов Александр

Задача:
    Пользователь вводит натуральное число n, затем n действительных чисел a1, a2, ..., an.
    Программа вычисляет сумму: -a1/1! + a2/2! - a3/3! + ... + (-1)^n * an/n!

Алгоритм:
    1. Ввод n (проверка на натуральность).
    2. Последовательный ввод n чисел.
    3. Для каждого i от 1 до n:
        - вычислить i! (факториал числа i),
        - определить знак: отрицательный при нечётном i, положительный — при чётном,
        - вычислить член ряда: знак * a_i / i!,
        - добавить член к общей сумме.
    4. Вывести результат с точностью до 6 знаков после запятой.
*/

#include <stdio.h>       // Для scanf, printf, fprintf
#include <locale.h>      // Для setlocale — поддержка русского языка
#include <windows.h>     // Для SetConsoleCP — корректная кодировка ввода/вывода в Windows

int main() {
    // Настройка локали и кодовой страницы консоли для корректного отображения русского текста
    setlocale(LC_ALL, ".UTF-8");
    SetConsoleCP(CP_UTF8);           // Устанавливает кодировку ввода в UTF-8
    SetConsoleOutputCP(CP_UTF8);     // Устанавливает кодировку вывода в UTF-8

    int n;  // Переменная для хранения количества чисел (натуральное число)

    // Приглашение к вводу n
    printf("Введите натуральное число n: ");
    
    // Считывает целое число и проверяет корректность ввода и условие n > 0
    if (scanf("%d", &n) != 1 || n <= 0) {
        // Если ввод некорректен или n не натуральное — выводит ошибку и завершает программу
        fprintf(stderr, "Ошибка: n должно быть натуральным числом (n > 0).\n");
        return 1;  // Возращает ошибку
    }

    // Объявляет переменную для накопления общей суммы ряда
    double sum = 0.0;

    // Информирует пользователя о количестве чисел, которые нужно ввести
    printf("Введите %d действительных чисел:\n", n);

    // Цикл по индексу i от 1 до n
    for (int i = 1; i <= n; i++) {
        double a_i;  // Текущее вводимое число a_i

        printf("a[%d] = ", i);

        // Считывает число типа double и проверяем успешность ввода
        if (scanf("%lf", &a_i) != 1) {
            fprintf(stderr, "Ошибка ввода числа a[%d].\n", i);
            return 1;  // Прерывает выполнение при ошибке ввода
        }

        // Вычисление факториала i! с помощью вложенного цикла
        long long factorial = 1;  // Использует long long для предотвращения переполнения при i <= 20
        for (int j = 1; j <= i; j++) {
            factorial *= j;  // Последовательное умножение: 1 * 2 * ... * i
        }

        // Определение знака члена ряда:
        //   при нечётном i -> знак "минус" (умножаем на -1),
        //   при чётном i -> знак "плюс"
        double term = a_i / factorial;  // Базовое значение члена без учёта знака
        if (i % 2 == 1) {               // Если i нечётное
            term = -term;               // Меняет знак на отрицательный
        }

        // Добавляет текущий член к общей сумме
        sum += term;

        // Выводит подробности вычисления текущего члена для наглядности
        printf("  Член %d: %s%.2f / %lld = %.6f\n",
               i,
               (i % 2 == 1) ? "-" : "+",  // Выбирает символ знака для отображения
               a_i,                        // Значение a_i
               factorial,                  // Значение i!
               term);                      // Значение члена ряда
    }

    // Выводит окончательный результат суммы с точностью до 6 знаков после запятой
    printf("\nРезультат выражения: %.6f\n", sum);

    // Завершение программы
    return 0;
}