/* 
Автор: Кузнецов Александр

Задача:
    Пользователь вводит натуральное число n, затем 2n действительных чисел.
    Программа вычисляет сумму: a1*a2n + a2*a2n-1 + ... + an*an+1

Алгоритм:
    1. Ввод n.
    2. Создание пустого двусвязного списка.
    3. Последовательный ввод 2n чисел и добавление их в конец списка.
    4. Поиск головы и хвоста списка.
    5. Итеративное перемножение пар: первый с последним, второй с предпоследним и т.д.
    6. Вывод результата.
    7. Освобождение памяти.
*/

#include <stdio.h>       // Подключает для printf/scanf — ввод и вывод
#include <locale.h>      // Подключает для setlocale — чтобы русский текст отображался
#include "list_utils.h"  // Подключает наш заголовочный файл — чтобы знать структуры и функции
#include <windows.h>     // Подключает для SetConsoleCP — настройка кодировки консоли Windows

int main() {
    // Настройка локали и кодировки консоли для корректного отображения русского текста
    setlocale(LC_ALL, ".UTF-8");
    SetConsoleCP(CP_UTF8);           // Кодировка ввода
    SetConsoleOutputCP(CP_UTF8);     // Кодировка вывода

    int n;                                // Переменная для хранения n — половины количества чисел
    printf("Введите натуральное число n: ");  // Выводит приглашение ввести n
    if (scanf("%d", &n) != 1 || n <= 0) {     // Считывает n; проверяет, что введено число > 0
        fprintf(stderr, "Ошибка: n должно быть натуральным числом.\n");  // Если ошибка — выводит сообщение
        return 1;                         // Завершает программу с кодом ошибки
    }

    int total = 2 * n;                    // Считает общее количество чисел — 2n

    Node* head = NULL;                    // Создаёт указатель на голову списка, изначально NULL — список пуст

    printf("Введите %d действительных чисел:\n", total);  // Сообщает пользователю, сколько чисел нужно ввести
    for (int i = 0; i < total; i++) {     // Цикл: вводим total чисел
        DataType value;                   // Переменная для хранения текущего введённого числа
        printf("a[%d] = ", i + 1);        // Выводит подсказку: a[1], a[2], ..., a_{2n}
        if (scanf("%lf", &value) != 1) {  // Считывает число типа double; проверяет успешность ввода
            fprintf(stderr, "Ошибка ввода числа.\n");  // Если ошибка — выводит сообщение
            free_list(head);              // Освобождает всю память, занятую списком (если что-то уже было добавлено)
            return 1;                     // Завершает программу с ошибкой
        }
        append(&head, value);             // Добавляет число в конец списка (передаём адрес головы)
    }

    Node* tail = get_tail(head);          // Находит хвост списка — последний элемент
    if (tail == NULL) {                   // Проверяет, не пуст ли список (теоретически не должно быть, если n>0)
        fprintf(stderr, "Ошибка: список пуст.\n");  // Если пуст — выводит ошибку
        return 1;                         // Завершает программу
    }

    Node* left = head;                    // Указатель на начало списка — будет двигаться вправо
    Node* right = tail;                   // Указатель на конец списка — будет двигаться влево
    DataType sum = 0.0;                   // Переменная для накопления суммы произведений

    printf("\nВычисление суммы произведений:\n");  // Выводит заголовок перед вычислениями
    for (int i = 0; i < n; i++) {         // Цикл: n итераций — перемножает пары
        DataType product = left->value * right->value;  // Вычисляет произведение текущей пары (первый * последний)
        sum += product;                   // Добавляет произведение к общей сумме
        printf("  a%d * a%d = %.2f * %.2f = %.2f\n",   // Выводит подробности вычисления
               i + 1, total - i, left->value, right->value, product);

        left = left->next;                // Сдвигает левый указатель вперёд (к следующему элементу)
        right = right->prev;              // Сдвигает правый указатель назад (к предыдущему элементу)
    }

    printf("\nРезультат выражения: %.2f\n", sum);  // Выводит финальный результат с точностью до 6 знаков

    free_list(head);                      // Освобождает всю память, занятую списком — избегает утечек

    return 0;    // Успешное завершение
}