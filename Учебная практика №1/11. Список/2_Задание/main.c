/*
main.c — основная программа (работает с двусвязным списком, без массивов)

Автор: Кузнецов Александр

Задача: 
    Пользователь вводит натуральное число n, затем 2n действительных чисел.
    Программа вычисляет сумму: a1*a2n + a2*a2n-1 + ... + an*an+1

Назначение: 
    Главный файл программы. Здесь происходит ввод данных, вызов функций из list_utils.c, вычисления и вывод результата.

Использует:
    - scanf, printf — ввод/вывод
    - setlocale, SetConsoleCP — настройка кодировки для русского языка в консоли Windows
    - функции из list_utils.h — для работы со списком

Алгоритм:
    1. Просит ввести n.
    2. Создаёт пустой список.
    3. В цикле вводит 2n чисел и добавляет их в конец списка.
    4. Находит голову и хвост списка.
    5. Считает сумму произведений: первый с последним, второй с предпоследним и т.д., двигаясь навстречу.
    6. Выводит результат.
    7. Освобождает память.
*/

#include <stdio.h>      // Для printf, scanf
#include <locale.h>     // Для setlocale — локализация (русский язык)
#include "list_utils.h" // Подключаем наши функции для работы со списком
#include <windows.h>    // Для SetConsoleCP — настройка кодировки консоли в Windows

/*
Функция: main

Описание:
    Точка входа в программу. Здесь всё начинается.

Назначение:
    Управлять процессом: ввод данных → обработка → вывод результата → очистка памяти.

Возвращаемое значение:
    int — код завершения (0 = успешно).
*/
int main() {
    // Настраивает локаль для корректного отображения русского текста
    setlocale(LC_ALL, ".UTF-8");     // Устанавливает локаль для всей программы
    SetConsoleCP(CP_UTF8);           // Устанавливает кодировку ввода консоли в UTF-8
    SetConsoleOutputCP(CP_UTF8);     // Устанавливает кодировку вывода консоли в UTF-8

    // Переменная для хранения n — половины количества чисел
    int n;
    printf("Введите натуральное число n: ");
    scanf("%d", &n);  // Читает n с клавиатуры

    // Считает общее количество чисел — 2n
    int total = 2 * n;

    // Создаёт указатель на голову списка, изначально NULL (список пуст)
    Node* head = NULL;

    // Сообщает пользователю, сколько чисел нужно ввести
    printf("Введите %d действительных чисел:\n", total);

    // Цикл: вводит total чисел и добавляет каждое в конец списка
    for (int i = 0; i < total; i++) {
        DataType value;  // Переменная для хранения введённого числа
        printf("a%d = ", i + 1);  // Подсказка: a1, a2, ..., a_{2n}
        scanf("%lf", &value);     // Читает число (lf = long float = double)

        // Добавляет число в конец списка
        // Передаёт адрес головы (&head), потому что функция может её изменить
        append(&head, value);
    }

    // Теперь список заполнен. Нужно найти хвост (последний элемент)
    Node* tail = get_tail(head);

    // Создаём два указателя: на начало (left) и на конец (right)
    Node* left = head;
    Node* right = tail;

    // Переменная для хранения итоговой суммы
    DataType sum = 0.0;

    // Цикл: считает сумму произведений a_i * a_{2n - i + 1}
    // Теперь нам не нужен массив, потому что у нас двусвязный список
    for (int i = 0; i < n; i++) {
        // Вычисляет произведение
        DataType product = left->value * right->value;

        // Добавляет произведение к сумме
        sum += product;

        // (Опционально) Выводит, что именно умножает
        printf(" -> %.2f * %.2f = %.2f\n", left->value, right->value, product);

        // Двигаем указатели навстречу друг другу
        left = left->next;   // идём вправо
        right = right->prev; // идём влево
    }

    // Выводит финальный результат
    printf("\nРезультат выражения: %.6f\n", sum);

    // Освобождает память: удаляет весь список
    free_list(head);

    // Программа завершается успешно
    return 0;
}
